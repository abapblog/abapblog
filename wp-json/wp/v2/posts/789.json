{"id":789,"date":"2012-04-26T19:49:22","date_gmt":"2012-04-26T15:49:22","guid":{"rendered":"http:\/\/abap-blog.ru\/?p=789"},"modified":"2021-03-02T10:01:54","modified_gmt":"2021-03-02T06:01:54","slug":"rabota-s-salv-tree","status":"publish","type":"post","link":"https:\/\/abap-blog.ru\/osnovy-abap\/sap-dynpro\/rabota-s-salv-tree\/","title":{"rendered":"\u0420\u0430\u0431\u043e\u0442\u0430 \u0441 SALV Tree"},"content":{"rendered":"<p>\u0414\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0434\u0435\u0440\u0435\u0432\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u0449\u0435\u0433\u043e \u0438\u0437 \u043b\u044e\u0431\u043e\u0433\u043e \u0447\u0438\u0441\u043b\u0430 \u0443\u0440\u043e\u0432\u043d\u0435\u0439 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0432 SALV \u043c\u043e\u0434\u0435\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u043b\u0430\u0441\u0441 &#8212; <strong>cl_salv_tree<\/strong>.<\/p>\n<p><strong><a href=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image03.png\"><img loading=\"lazy\" title=\"image03\" src=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image03.png\" alt=\"\" width=\"748\" height=\"272\" \/><\/a><\/strong><\/p>\n<p>\u0421\u0442\u0440\u043e\u043a\u0438 \u0432 \u0442\u0430\u043a\u043e\u043c \u0434\u0435\u0440\u0435\u0432\u0435 \u043d\u0430\u0437\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0443\u0437\u043b\u0430\u043c\u0438. \u041a\u0430\u0436\u0434\u044b\u0439 \u0443\u0437\u0435\u043b, \u043d\u0435 \u0432\u0430\u0436\u043d\u043e, \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u043e\u043d \u0443\u0440\u043e\u0432\u043d\u0435, \u0438\u043c\u0435\u0435\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u043c\u0438.<\/p>\n<p>\u0414\u0435\u0440\u0435\u0432\u043e, \u043a\u0430\u043a \u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u043a\u043b\u0430\u0441\u0441\u044b SALV \u043c\u043e\u0434\u0435\u043b\u0438, \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0444\u0430\u0431\u0440\u0438\u0447\u043d\u043e-\u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0430 <strong>factory()<\/strong>. \u041f\u0440\u0438 \u044d\u0442\u043e\u043c \u043f\u0440\u0438 \u0435\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u0441 \u0434\u0430\u043d\u043d\u044b\u043c\u0438, \u0430 \u043f\u0443\u0441\u0442\u0443\u044e. \u0417\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u044d\u0442\u0430\u043f\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u043e\u0432 \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0434\u0435\u0440\u0435\u0432\u0430. \u041e\u0431\u044a\u0435\u043a\u0442 \u0434\u0435\u0440\u0435\u0432\u0430 \u043c\u043e\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u0430\u043a \u0432\u00a0\u043f\u043e\u043b\u043d\u043e \u044d\u043a\u0440\u0430\u043d\u043d\u043e\u043c\u00a0\u0440\u0435\u0436\u0438\u043c\u0435, \u0442\u0430\u043a \u0438 \u0432 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0435 \u0443\u043a\u0430\u0437\u0430\u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 r_container. \u041a\u0440\u043e\u043c\u0435 \u0442\u043e\u0433\u043e \u043c\u043e\u0436\u043d\u043e \u0441\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0434\u0435\u0440\u0435\u0432\u0430 \u2013 \u043f\u0435\u0440\u0435\u0434\u0430\u0432 \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 hide_header \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 abap_true (X).<\/p>\n<p><!--more--><\/p>\n<p>\u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0434\u0435\u0440\u0435\u0432\u0430, \u0431\u0435\u0437 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438:<\/p>\n<pre class=\"lang:abap decode:true \">REPORT\r\n\r\nFIELD-SYMBOLS:\r\n\r\nCLASS\r\n  PUBLIC SECTION.\r\n    CLASS-DATA:\r\n      go_alv_tree     TYPE REF TO cl_salv_tree,\r\n      gt_empty_tab    TYPE STANDARD TABLE OF spfli,\r\n      gt_full_tab     TYPE STANDARD TABLE OF spfli.\r\n    CLASS-METHODS:\r\n      create_tree,     \" \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u0438 \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442 ALV\r\n      get_data,       \" \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 \u0411\u0414\r\n      create_nodes,   \" \u0417\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u0435\u0440\u0435\u0432\u0430 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 (\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438)\r\n      show_tree.      \" \u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 (\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435) ALV \u0434\u0435\u0440\u0435\u0432\u0430\r\nENDCLASS.\r\n\r\nSTART-OF-SELECTION.\r\n  lcl_report=&gt;get_data( ).\r\n  lcl_report=&gt;create_tree( ).\r\n  lcl_report=&gt;create_nodes( ).\r\n  lcl_report=&gt;show_tree( ).\r\n\r\nCLASS lcl_report IMPLEMENTATION.\r\n  METHOD show_tree.\r\n    go_alv_tree-&gt;display( ).\r\n  ENDMETHOD.\r\n\r\n  METHOD create_nodes.\r\n    DATA:\r\n      lo_nodes  TYPE REF TO cl_salv_nodes,\r\n      lo_node   TYPE REF TO cl_salv_node.\r\n    \" \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430 \u0443\u043f\u0440\u0432\u043b\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430\u043c\u0438 \u0434\u0435\u0440\u0435\u0432\u0430\r\n    lo_nodes = go_alv_tree-&gt;get_nodes( ).\r\n    SORT gt_full_tab BY carrid.\r\n    \" \u0417\u0430\u043f\u043e\u043b\u043d\u044f\u0435\u043c \u0434\u0435\u0440\u0435\u0432\u043e\r\n    LOOP AT gt_full_tab ASSIGNING &lt;fs_line&gt;.\r\n      TRY.\r\n          lo_node = lo_nodes-&gt;add_node( related_node = ''\r\n                    relationship = cl_gui_column_tree=&gt;relat_first_child\r\n                                      ).\r\n          \" \u041f\u0440\u0438\u0441\u0432\u043e\u0435\u043d\u0438\u0435 \u0443\u0437\u043b\u0443 \u0434\u0430\u043d\u043d\u044b\u0445\r\n          lo_node-&gt;set_data_row( &lt;fs_line&gt; ).\r\n        CATCH cx_salv_msg.\r\n      ENDTRY.\r\n    ENDLOOP.\r\n  ENDMETHOD.\r\n\r\n  METHOD get_data.\r\n    SELECT * FROM spfli INTO CORRESPONDING FIELDS OF TABLE gt_full_tab.\r\n  ENDMETHOD.\r\n\r\n  METHOD create_tree.\r\n    TRY.\r\n        cl_salv_tree=&gt;factory(\r\n          IMPORTING\r\n            r_salv_tree = go_alv_tree\r\n          CHANGING\r\n            t_table     = gt_empty_tab ).\r\n      CATCH cx_salv_error.\r\n        MESSAGE '\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 ALV' TYPE 'E'.\r\n    ENDTRY.\r\n  ENDMETHOD.\r\n\r\nENDCLASS.<\/pre>\n<p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b:<\/p>\n<p><strong><a href=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image00.png\"><img loading=\"lazy\" class=\"alignnone size-full wp-image-794\" title=\"image00\" src=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image00.png\" alt=\"\" width=\"691\" height=\"157\" srcset=\"https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image00.png 691w, https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image00-300x68.png 300w\" sizes=\"(max-width: 691px) 100vw, 691px\" \/><\/a><\/strong><\/p>\n<div dir=\"ltr\"><strong>\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438<\/strong><\/div>\n<div dir=\"ltr\">\n\u0427\u0442\u043e\u0431\u044b \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e, \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0434\u0435\u0440\u0435\u0432\u0430 \u0443\u0437\u043b\u0430\u043c\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435 \u0438 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u0443\u0437\u043b\u044b. \u0414\u043b\u044f \u0442\u043e\u0433\u043e \u0447\u0442\u043e\u0431\u044b \u0438\u0445 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c\u0441\u044f \u0441 \u043c\u0435\u0442\u043e\u0434\u043e\u043c \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430 &#8212; <strong>add_node<\/strong>. \u041c\u0435\u0442\u043e\u0434 \u0438\u043c\u0435\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b:<\/div>\n<div dir=\"ltr\"><\/div>\n<div dir=\"ltr\">\n<table>\n<tbody>\n<tr>\n<td><strong>\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440<\/strong><\/td>\n<td><strong>\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435<\/strong><\/td>\n<\/tr>\n<tr>\n<td>related_node<\/td>\n<td>\u041a\u043b\u044e\u0447 \u0443\u0437\u043b\u0430, \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u0431\u0443\u0434\u0435\u043c \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0443\u0437\u0435\u043b \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0434\u043e\u0447\u0435\u0440\u043d\u0435\u0433\u043e (\u0438\u043b\u0438 \u0431\u0440\u0430\u0442\u0441\u043a\u043e\u0433\u043e \u2013 \u043a \u0442\u043e\u043c\u0443 \u0436\u0435 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044e \u0447\u0442\u043e \u0438 \u0443 \u043d\u0435\u0433\u043e). \u0414\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430 \u0432 \u043a\u043b\u0430\u0441\u0441\u0435 cl_salv_node \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u043c\u0435\u0442\u043e\u0434 key. \u0415\u0441\u043b\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e\u0435 \u0443\u0437\u0435\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430 \u0441\u0430\u043c\u044b\u0439 \u0432\u0435\u0440\u0445\u043d\u0438\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c.<\/td>\n<\/tr>\n<tr>\n<td>relationship<\/td>\n<td>\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0437\u0430\u0439\u043c\u0435\u0442 \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 \u0443\u0437\u0435\u043b, \u0437\u0430\u0434\u0430\u0435\u0442\u0441\u044f \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430\u043c\u0438 \u0438\u0437 \u043a\u043b\u0430\u0441\u0441\u0430 cl_gui_column_tree:<\/p>\n<ul>\n<li>relat_first_child \u2013 \u0443\u0437\u0435\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043f\u0435\u0440\u0432\u044b\u043c \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0439<\/li>\n<li>relat_last_child \u2013 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u043c<\/li>\n<li>relat_first_sibling \u2013 \u0443\u0437\u0435\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u043f\u0435\u0440\u0432\u044b\u0439 \u0431\u0440\u0430\u0442\u0441\u043a\u0438\u0439<\/li>\n<li>relat_last_sibling \u2013 \u0443\u0437\u0435\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0431\u0440\u0430\u0442\u0441\u043a\u0438\u0439<\/li>\n<li>relat_next_sibling \u2013 \u0443\u0437\u0435\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0431\u0440\u0430\u0442\u0441\u043a\u0438\u0439<\/li>\n<li>relat_prev_sibling \u2013 \u0443\u0437\u0435\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u0431\u0440\u0430\u0442\u0441\u043a\u0438\u0439<\/li>\n<\/ul>\n<\/td>\n<\/tr>\n<tr>\n<td>data_row<\/td>\n<td>\u0414\u0430\u043d\u043d\u044b\u0435 \u0443\u0437\u043b\u0430, \u0441 \u0442\u043e\u0439 \u0436\u0435 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043e\u0439 \u0447\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0430\u0441\u044c \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u0432 \u0444\u0430\u0431\u0440\u0438\u0447\u043d\u043e\u043c \u043c\u0435\u0442\u043e\u0434\u0435.<\/td>\n<\/tr>\n<tr>\n<td>collapsen_icon<\/td>\n<td>\u0418\u043a\u043e\u043d\u043a\u0430 \u0432 \u0441\u0432\u0435\u0440\u043d\u0443\u0442\u043e\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438<\/td>\n<\/tr>\n<tr>\n<td>expanded_icon<\/td>\n<td>\u0418\u043a\u043e\u043d\u043a\u0430 \u0432 \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u043e\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438<\/td>\n<\/tr>\n<tr>\n<td>text<\/td>\n<td>\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u0442\u0435\u043a\u0441\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043b\u043e\u043d\u043a\u0443 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0434\u043b\u044f \u0443\u0437\u043b\u0430<\/td>\n<\/tr>\n<tr>\n<td>visible<\/td>\n<td>\u0412\u0438\u0434\u0438\u043c\u043e\u0441\u0442\u044c \u0443\u0437\u043b\u0430<\/td>\n<\/tr>\n<tr>\n<td>folder<\/td>\n<td>\u0415\u0441\u043b\u0438 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432 abap_true, \u0443\u0437\u0435\u043b \u0431\u0443\u0434\u0435\u0442 \u0438\u043c\u0435\u0442\u044c \u0438\u043a\u043e\u043d\u043a\u0443 \u0432 \u0441\u0432\u0435\u0440\u043d\u0443\u0442\u043e\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438, \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432<\/td>\n<\/tr>\n<tr>\n<td>expander<\/td>\n<td>\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0442\u044c \u043b\u0438 \u0444\u043b\u0430\u0436\u043e\u043a \u0440\u0430\u0437\u0432\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u044f (\u0441\u0432\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u044f) \u0443\u0440\u043e\u0432\u043d\u044f \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0434\u043b\u044f \u0443\u0437\u043b\u0430<\/td>\n<\/tr>\n<tr>\n<td>row_style<\/td>\n<td>\u0417\u0430\u0434\u0430\u0435\u0442 \u0441\u0442\u0438\u043b\u044c (\u0446\u0432\u0435\u0442) \u0434\u043b\u044f \u0443\u0437\u043b\u0430. \u0412\u0438\u0434\u044b \u0441\u0442\u0438\u043b\u0435\u0439 \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0438 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 IF_SALV_C_TREE_STYLE \u0438 \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f:<\/p>\n<ul>\n<li>DEFAULT<\/li>\n<li>INHERITED<\/li>\n<li>INTENSIFIED<\/li>\n<li>INACTIVE<\/li>\n<li>INTENSIFIED_CRITICAL<\/li>\n<li>EMPHASIZED_NEGATIVE<\/li>\n<li>EMPHASIZED_POSITIVE<\/li>\n<li>EMPHASIZED<\/li>\n<li>EMPHASIZED_A<\/li>\n<li>EMPHASIZED_B<\/li>\n<li>EMPHASIZED_C<\/li>\n<\/ul>\n<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<div dir=\"ltr\">\u041a\u0440\u043e\u043c\u0435 \u0442\u043e\u0433\u043e \u0447\u0442\u043e\u0431\u044b \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u0430\u044f \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u043b\u0430\u0441\u044c \u043d\u0430 \u044d\u043a\u0440\u0430\u043d\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0434\u0435\u0440\u0435\u0432\u0430. \u0417\u0430 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0443 \u0434\u0435\u0440\u0435\u0432\u0430 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043a\u043b\u0430\u0441\u0441 <strong>cl_salv_tree_settings<\/strong>. \u0414\u0430\u043b\u0435\u0435 \u043f\u0440\u0438\u043c\u0435\u0440 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043d\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0430, \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438:<\/div>\n<div dir=\"ltr\"><\/div>\n<div dir=\"ltr\">\n<pre class=\"lang:abap decode:true \">METHOD create_nodes.\r\n    DATA:\r\n      lo_nodes  TYPE REF TO cl_salv_nodes,\r\n      lo_node   TYPE REF TO cl_salv_node,\r\n      lv_carrid_key TYPE lvc_nkey,\r\n      lv_expand_icon TYPE SALV_DE_TREE_IMAGE,\r\n      lv_collapse_icon TYPE SALV_DE_TREE_IMAGE,\r\n      lv_hier_icon    TYPE SALV_DE_TREE_IMAGE,\r\n      lo_settings TYPE REF TO cl_salv_tree_settings,\r\n      lv_carrid TYPE spfli-carrid.\r\n\r\n    lv_expand_icon = icon_expand.\r\n    lv_collapse_icon = icon_collapse.\r\n    lv_hier_icon = icon_tree.\r\n\r\n    lo_settings = go_alv_tree-&gt;get_tree_settings( ).\r\n    lo_settings-&gt;set_hierarchy_header( '\u0418\u0435\u0440\u0430\u0440\u0445\u0438\u044f' ).\r\n    lo_settings-&gt;set_hierarchy_size( 30 ).\r\n    lo_settings-&gt;set_hierarchy_icon( lv_hier_icon ).\r\n\r\n    \" \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430 \u0443\u043f\u0440\u0432\u043b\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430\u043c\u0438 \u0434\u0435\u0440\u0435\u0432\u0430\r\n    lo_nodes = go_alv_tree-&gt;get_nodes( ).\r\n    SORT gt_full_tab BY carrid.\r\n    \" \u0417\u0430\u043f\u043e\u043b\u043d\u044f\u0435\u043c \u0434\u0435\u0440\u0435\u0432\u043e\r\n    LOOP AT gt_full_tab ASSIGNING &lt;fs_line&gt;.\r\n      IF lv_carrid &lt;&gt; &lt;fs_line&gt;-carrid.\r\n        TRY.\r\n            lo_node = lo_nodes-&gt;add_node(\r\n                                  related_node   = ''\r\n                                  relationship   = cl_gui_column_tree=&gt;relat_last_child\r\n                                  data_row       = &lt;fs_line&gt;\r\n                                  collapsed_icon = lv_expand_icon\r\n                                  expanded_icon  = lv_collapse_icon\r\n                                  row_style      = IF_SALV_C_TREE_STYLE=&gt;emphasized_a\r\n                                  text           = '\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0443\u0437\u0435\u043b' ).\r\n            lv_carrid_key = lo_node-&gt;get_key( ).\r\n          CATCH cx_salv_msg.\r\n        ENDTRY.\r\n      ELSE.\r\n        TRY.\r\n            lo_node = lo_nodes-&gt;add_node(\r\n                                  related_node   = lv_carrid_key\r\n                                  relationship   = cl_gui_column_tree=&gt;relat_last_child\r\n                                  data_row       = &lt;fs_line&gt;\r\n                                  collapsed_icon = lv_expand_icon\r\n                                  row_style      = IF_SALV_C_TREE_STYLE=&gt;emphasized_b\r\n                                  expanded_icon  = lv_collapse_icon\r\n                                  text           = '\u0414\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u0443\u0437\u0435\u043b' ).\r\n          CATCH cx_salv_msg.\r\n        ENDTRY.\r\n      ENDIF.\r\n      lv_carrid = &lt;fs_line&gt;-carrid.\r\n    ENDLOOP.\r\n  ENDMETHOD.<\/pre>\n<p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b:<\/p>\n<\/div>\n<p><strong><a href=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image01.png\"><img loading=\"lazy\" class=\"alignnone size-full wp-image-795\" title=\"image01\" src=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image01.png\" alt=\"\" width=\"685\" height=\"210\" srcset=\"https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image01.png 685w, https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image01-300x91.png 300w\" sizes=\"(max-width: 685px) 100vw, 685px\" \/><\/a><\/strong><\/p>\n<p><strong id=\"internal-source-marker_0.49962616129778326\">\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0439<\/strong><\/p>\n<p>\u041a\u0430\u043a \u0438 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u0441 <strong>cl_salv_table<\/strong>, \u0434\u043b\u044f \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u0436\u0438\u043c\u0430 \u043a\u043d\u043e\u043f\u043a\u0438 \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 GUI \u0441\u0442\u0430\u0442\u0443\u0441, \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u043c\u043e\u0436\u043d\u043e \u0432\u0437\u044f\u0442\u044c \u0438\u0437 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b &#8212; SALV_DEMO_TREE_SIMPLE. \u0415\u0441\u043b\u0438 \u0434\u0435\u0440\u0435\u0432\u043e \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0435, \u0442\u043e \u0447\u0435\u0440\u0435\u0437 \u043a\u043b\u0430\u0441\u0441<strong> cl_salv_functions_tree<\/strong> . \u00a0\u041e\u0434\u043d\u0430\u043a\u043e \u0442\u0443\u0442 \u043d\u0435\u0442 \u044f\u0432\u043d\u043e\u0433\u043e \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f \u043d\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 GUI \u0441\u0442\u0430\u0442\u0443\u0441\u0430 \u0432 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435, \u043c\u043e\u0436\u043d\u043e \u0432\u043c\u0435\u0441\u0442\u043e \u043d\u0435\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0448\u0435\u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0439 \u043a\u043b\u0430\u0441\u0441, \u043f\u0440\u0438\u043c\u0435\u0440 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043a\u043d\u043e\u043f\u043e\u043a:<\/p>\n<pre class=\"lang:abap decode:true \">METHOD setup_functions.\r\n    go_alv_tree-&gt;set_screen_status(\r\n      pfstatus      =  'SALV_STANDARD'\r\n      REPORT        =  sy-repid \" \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043b\u0438 \u043a \u0441\u0435\u0431\u0435 \u0432 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0443 \u0441\u0442\u0430\u0442\u0443\u0441\r\n      set_functions =  go_alv_tree-&gt;c_functions_all ).\r\n  ENDMETHOD.<\/pre>\n<p>\u0418\u043b\u0438:<\/p>\n<pre class=\"lang:abap decode:true\">METHOD setup_functions.\r\n    DATA: lo_functions TYPE REF TO cl_salv_functions_tree.\r\n\r\n    lo_functions = go_alv_tree-&gt;get_functions( ).\r\n    lo_functions-&gt;set_all( ).\r\nENDMETHOD.<\/pre>\n<p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0430\u0431\u043e\u0442\u044b:<\/p>\n<p><strong><a href=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image02.png\"><img loading=\"lazy\" class=\"alignnone size-full wp-image-796\" title=\"image02\" src=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image02.png\" alt=\"\" width=\"663\" height=\"96\" srcset=\"https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image02.png 663w, https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image02-300x43.png 300w\" sizes=\"(max-width: 663px) 100vw, 663px\" \/><\/a><\/strong><\/p>\n<p><em>\u0415\u0441\u043b\u0438 \u0432\u0434\u0440\u0443\u0433 \u043a\u043d\u043e\u043f\u043a\u0430 \u0441\u0443\u043c\u043c\u044b \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u0435 \u0435\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0435\u0439 &#8212; &amp;CALC_SUM.<\/em><\/p>\n<p><strong id=\"internal-source-marker_0.49962616129778326\">\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043a\u043e\u043b\u043e\u043d\u043e\u043a<\/strong><\/p>\n<p>\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043a\u043e\u043b\u043e\u043d\u043e\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u0430\u043a \u0436\u0435 \u043a\u0430\u043a \u0438 \u0441<strong> cl_salv_table<\/strong>, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0442\u043e\u0433\u043e \u0447\u0442\u043e \u0434\u043b\u044f \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043a\u043e\u043b\u043e\u043d\u043e\u043a \u0432 \u0434\u0435\u0440\u0435\u0432\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u043a\u043b\u0430\u0441\u0441\u044b \u2013<strong> cl_salv_columns_tree<\/strong> \u0438 <strong>cl_salv_column_tree<\/strong>. \u041f\u0440\u0438\u043c\u0435\u0440 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043a\u043e\u043b\u043e\u043d\u043e\u043a \u2013 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0438:<\/p>\n<pre class=\"lang:abap decode:true \">  METHOD setup_columns.\r\n    DATA:\r\n      lo_columns TYPE REF TO cl_salv_columns_tree,\r\n      lo_column  TYPE REF TO cl_salv_column_tree.\r\n\r\n    lo_columns = go_alv_tree-&gt;get_columns( ).\r\n    lo_columns-&gt;set_optimize( abap_true ).\r\n  ENDMETHOD.<\/pre>\n<p><strong id=\"internal-source-marker_0.49962616129778326\">\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439<\/strong><\/p>\n<p>\u0417\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0434\u0435\u0440\u0435\u0432\u0430 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043a\u043b\u0430\u0441\u0441 <strong>cl_salv_events_tree<\/strong>. \u0414\u043b\u044f \u0434\u0435\u0440\u0435\u0432\u0430 \u043c\u043e\u0436\u043d\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f:<\/p>\n<ul>\n<li>\u00a0TOP_OF_PAGE \u2013 \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430<\/li>\n<li>\u00a0END_OF_PAGE \u2013 \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u043f\u043e\u0434\u0432\u0430\u043b\u0430<\/li>\n<li>\u00a0BEFORE_SALV_FUNCTION \u2013 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0434\u043e \u0432\u044b\u0437\u043e\u0432\u0430 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438<\/li>\n<li>\u00a0AFTER_SALV_FUNCTION \u2013 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u043e\u0441\u043b\u0435 \u0432\u044b\u0437\u043e\u0432\u0430 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438<\/li>\n<li>\u00a0ADDED_FUNCTION \u2013 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u0432\u043e\u0435\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438<\/li>\n<li>\u00a0LINK_CLICK \u2013 \u0449\u0435\u043b\u0447\u043e\u043a \u043f\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u043c\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 (\u043a\u043d\u043e\u043f\u043a\u0430, \u0441\u0441\u044b\u043b\u043a\u0430 \u0438 \u0442.\u043f.)<\/li>\n<li>\u00a0DOUBLE_CLICK \u2013 \u0434\u0432\u043e\u0439\u043d\u043e\u0439 \u0449\u0435\u043b\u0447\u043e\u043a<\/li>\n<li>\u00a0KEYPRESS \u2013 \u043d\u0430\u0436\u0430\u0442\u0438\u0435 \u043a\u043b\u0430\u0432\u0438\u0448<\/li>\n<li>\u00a0CHECKBOX_CHANGE \u2013 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 \u0433\u0430\u043b\u043e\u0447\u043a\u0438 \u0443 \u0437\u0430\u043f\u0438\u0441\u0438<\/li>\n<li>\u00a0EXPAND_EMPTY_FOLDER \u2013 \u043f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043f\u0443\u0441\u0442\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443<\/li>\n<\/ul>\n<p>\u041f\u0440\u0438\u043c\u0435\u0440 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u044d\u0442\u0438\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0432 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0439 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0435 \u00a0&#8212; SALV_DEMO_TREE_EVENTS.<\/p>\n<p><strong id=\"internal-source-marker_0.49962616129778326\"><\/strong><strong id=\"internal-source-marker_0.49962616129778326\">\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u044f\u0447\u0435\u0435\u043a \u0443\u0437\u043b\u0430<\/strong><\/p>\n<p><strong id=\"internal-source-marker_0.49962616129778326\"><\/strong>\u0414\u043b\u044f \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u044f\u0447\u0435\u0435\u043a \u0432 \u0443\u0437\u043b\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u043b\u0430\u0441\u0441 <strong>cl_salv_item<\/strong>. \u0421 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043d\u0435\u0433\u043e \u043c\u043e\u0436\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0441\u0442\u0438\u043b\u044c \u044f\u0447\u0435\u0439\u043a\u0438, \u0432\u0438\u0434 (\u043a\u043d\u043e\u043f\u043a\u0430, \u0441\u0441\u044b\u043b\u043a\u0430 \u0438 \u0442.\u043f.), \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0435\u0441\u043b\u0438 \u0442\u0438\u043f \u2013 \u0433\u0430\u043b\u043e\u0447\u043a\u0430 (checkbox). \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430 \u0434\u043b\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u044f\u0447\u0435\u0439\u043a\u0438 \u043c\u043e\u0436\u043d\u043e \u0438\u0437 \u0443\u0437\u043b\u0430, \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043c\u0435\u0442\u043e\u0434\u0430 get_item( \u2018\u0418\u043c\u044f\u042f\u0447\u0435\u0439\u043a\u0438\u2019). \u041d\u0438\u0436\u0435 \u043f\u0440\u0438\u043c\u0435\u0440 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043d\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0430 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438:<\/p>\n<pre class=\"lang:abap decode:true \">METHOD create_nodes.\r\n    DATA:\r\n      lo_nodes  TYPE REF TO cl_salv_nodes,\r\n      lo_node   TYPE REF TO cl_salv_node,\r\n      lv_carrid_key TYPE lvc_nkey,\r\n      lv_expand_icon TYPE SALV_DE_TREE_IMAGE,\r\n      lv_collapse_icon TYPE SALV_DE_TREE_IMAGE,\r\n      lv_hier_icon    TYPE SALV_DE_TREE_IMAGE,\r\n      lo_item     TYPE REF TO cl_salv_item,\r\n      lo_settings TYPE REF TO cl_salv_tree_settings,\r\n      lv_carrid TYPE spfli-carrid.\r\n\r\n    lv_expand_icon = icon_expand.\r\n    lv_collapse_icon = icon_collapse.\r\n    lv_hier_icon = icon_tree.\r\n\r\n    lo_settings = go_alv_tree-&gt;get_tree_settings( ).\r\n    lo_settings-&gt;set_hierarchy_header( '\u0418\u0435\u0440\u0430\u0440\u0445\u0438\u044f' ).\r\n    lo_settings-&gt;set_hierarchy_size( 30 ).\r\n    lo_settings-&gt;set_hierarchy_icon( lv_hier_icon ).\r\n\r\n    \" \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430 \u0443\u043f\u0440\u0432\u043b\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430\u043c\u0438 \u0434\u0435\u0440\u0435\u0432\u0430\r\n    lo_nodes = go_alv_tree-&gt;get_nodes( ).\r\n    SORT gt_full_tab BY carrid.\r\n    \" \u0417\u0430\u043f\u043e\u043b\u043d\u044f\u0435\u043c \u0434\u0435\u0440\u0435\u0432\u043e\r\n    LOOP AT gt_full_tab ASSIGNING &lt;fs_line&gt;.\r\n      IF lv_carrid &lt;&gt; &lt;fs_line&gt;-carrid.\r\n        TRY.\r\n            lo_node = lo_nodes-&gt;add_node(\r\n                                  related_node   = ''\r\n                                  relationship   = cl_gui_column_tree=&gt;relat_last_child\r\n                                  data_row       = &lt;fs_line&gt;\r\n                                  collapsed_icon = lv_expand_icon\r\n                                  expanded_icon  = lv_collapse_icon\r\n                                  row_style      = IF_SALV_C_TREE_STYLE=&gt;emphasized_a\r\n                                  text           = '\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0443\u0437\u0435\u043b' ).\r\n            lv_carrid_key = lo_node-&gt;get_key( ).\r\n            lo_item = lo_node-&gt;get_item( 'CARRID' ).\r\n            lo_item-&gt;set_type(  if_salv_c_item_type=&gt;button ).\r\n            lo_item = lo_node-&gt;get_item( 'CITYFROM' ).\r\n            lo_item-&gt;set_font( if_salv_c_item_font=&gt;fixed_size ).\r\n            lo_item-&gt;set_enabled( abap_false ).\r\n          CATCH cx_salv_msg.\r\n        ENDTRY.\r\n      ELSE.\r\n        TRY.\r\n            lo_node = lo_nodes-&gt;add_node(\r\n                                  related_node   = lv_carrid_key\r\n                                  relationship   = cl_gui_column_tree=&gt;relat_last_child\r\n                                  data_row       = &lt;fs_line&gt;\r\n                                  collapsed_icon = lv_expand_icon\r\n                                  row_style      = IF_SALV_C_TREE_STYLE=&gt;emphasized_negative\r\n                                  expanded_icon  = lv_collapse_icon\r\n                                  text           = '\u0414\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u0443\u0437\u0435\u043b - \u0414\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u0443\u0437\u0435\u043b' ).\r\n            lo_item = lo_node-&gt;get_item( 'CARRID' ).\r\n            lo_item-&gt;set_type(  if_salv_c_item_type=&gt;checkbox ).\r\n            lo_item-&gt;set_editable( abap_true ).\r\n          CATCH cx_salv_msg.\r\n        ENDTRY.\r\n      ENDIF.\r\n      lv_carrid = &lt;fs_line&gt;-carrid.\r\n    ENDLOOP.\r\n  ENDMETHOD.                    \"create_nodes<\/pre>\n<p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b:<\/p>\n<p><strong><a href=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image03.png\"><img loading=\"lazy\" class=\"alignnone size-full wp-image-797\" title=\"image03\" src=\"http:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image03.png\" alt=\"\" width=\"748\" height=\"272\" srcset=\"https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image03.png 748w, https:\/\/abap-blog.ru\/wp-content\/uploads\/2012\/04\/image03-300x109.png 300w\" sizes=\"(max-width: 748px) 100vw, 748px\" \/><\/a><\/strong><\/p>\n<p>\u041d\u0430\u043f\u043e\u0441\u043b\u0435\u0434\u043e\u043a \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u0446\u0435\u043b\u0438\u043a\u043e\u043c, c \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u043c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0438 \u043e\u0431\u0445\u043e\u0434\u0430 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u0443\u0437\u043b\u043e\u0432:<\/p>\n<pre class=\"lang:abap decode:true \">REPORT zsalv_tree_sample.\r\n\r\nFIELD-SYMBOLS: &lt;fs_line&gt; TYPE spfli.\r\nINCLUDE &lt;icon&gt;.\r\n\r\nCLASS lcl_report DEFINITION.\r\n  PUBLIC SECTION.\r\n    CLASS-DATA:\r\n      go_alv_tree     TYPE REF TO cl_salv_tree,\r\n      gt_empty_tab    TYPE STANDARD TABLE OF spfli,\r\n      gt_full_tab     TYPE STANDARD TABLE OF spfli.\r\n    CLASS-METHODS:\r\n      create_tree,    \" \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u0438 \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442 ALV\r\n      get_data,       \" \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 \u0411\u0414\r\n      setup_functions,\" \u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0442\u0443\u043b\u0431\u0430\u0440\u0430\r\n      create_nodes,   \" \u0417\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u0435\u0440\u0435\u0432\u0430 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 (\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438)\r\n      setup_columns,  \" \u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043a\u043e\u043b\u043e\u043d\u043e\u043a\r\n      on_link_click FOR EVENT link_click OF cl_salv_events_tree IMPORTING NODE_KEY,\r\n      setup_events,\r\n      show_tree.      \" \u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 (\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435) ALV \u0434\u0435\u0440\u0435\u0432\u0430\r\nENDCLASS.                    \"lcl_report DEFINITION\r\n\r\nSTART-OF-SELECTION.\r\n  lcl_report=&gt;get_data( ).\r\n  lcl_report=&gt;create_tree( ).\r\n  lcl_report=&gt;create_nodes( ).\r\n  lcl_report=&gt;setup_functions( ).\r\n  lcl_report=&gt;setup_columns( ).\r\n  lcl_report=&gt;setup_events( ).\r\n  lcl_report=&gt;show_tree( ).\r\n\r\nCLASS lcl_report IMPLEMENTATION.\r\n  METHOD show_tree.\r\n    go_alv_tree-&gt;display( ).\r\n  ENDMETHOD.                    \"show_tree\r\n\r\n  METHOD create_nodes.\r\n    DATA:\r\n      lo_nodes  TYPE REF TO cl_salv_nodes,\r\n      lo_node   TYPE REF TO cl_salv_node,\r\n      lv_carrid_key TYPE lvc_nkey,\r\n      lv_expand_icon TYPE SALV_DE_TREE_IMAGE,\r\n      lv_collapse_icon TYPE SALV_DE_TREE_IMAGE,\r\n      lv_hier_icon    TYPE SALV_DE_TREE_IMAGE,\r\n      lo_item     TYPE REF TO cl_salv_item,\r\n      lv_count TYPE I,\r\n      lo_settings TYPE REF TO cl_salv_tree_settings,\r\n      lv_carrid TYPE spfli-carrid.\r\n\r\n    lv_expand_icon = ICON_CLOSED_FOLDER.\r\n    lv_collapse_icon = ICON_OPEN_FOLDER.\r\n    lv_hier_icon = icon_tree.\r\n\r\n    lo_settings = go_alv_tree-&gt;get_tree_settings( ).\r\n    lo_settings-&gt;set_hierarchy_header( '\u0418\u0435\u0440\u0430\u0440\u0445\u0438\u044f' ).\r\n    lo_settings-&gt;set_hierarchy_size( 30 ).\r\n    lo_settings-&gt;set_hierarchy_icon( lv_hier_icon ).\r\n\r\n    \" \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430 \u0443\u043f\u0440\u0432\u043b\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430\u043c\u0438 \u0434\u0435\u0440\u0435\u0432\u0430\r\n    lo_nodes = go_alv_tree-&gt;get_nodes( ).\r\n    SORT gt_full_tab BY carrid.\r\n    \" \u0417\u0430\u043f\u043e\u043b\u043d\u044f\u0435\u043c \u0434\u0435\u0440\u0435\u0432\u043e\r\n    LOOP AT gt_full_tab ASSIGNING &lt;fs_line&gt;.\r\n      IF lv_carrid &lt;&gt; &lt;fs_line&gt;-carrid.\r\n        TRY.\r\n            lv_count = 0.\r\n            LOOP AT gt_full_tab TRANSPORTING NO FIELDS WHERE carrid = &lt;fs_line&gt;-carrid.\r\n              lv_count = lv_count + 1.\r\n            ENDLOOP.\r\n            IF lv_count &gt; 1.\r\n              lo_node = lo_nodes-&gt;add_node(\r\n                                    related_node   = ''\r\n                                    relationship   = cl_gui_column_tree=&gt;relat_last_child\r\n                                    data_row       = &lt;fs_line&gt;\r\n                                    collapsed_icon = lv_expand_icon\r\n                                    expanded_icon  = lv_collapse_icon\r\n                                    row_style      = IF_SALV_C_TREE_STYLE=&gt;emphasized_a\r\n                                    text           = '\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0443\u0437\u0435\u043b' ).\r\n            ELSE.\r\n              lo_node = lo_nodes-&gt;add_node(\r\n                                    related_node   = ''\r\n                                    relationship   = cl_gui_column_tree=&gt;relat_last_child\r\n                                    data_row       = &lt;fs_line&gt;\r\n                                    collapsed_icon = lv_collapse_icon\r\n                                    row_style      = IF_SALV_C_TREE_STYLE=&gt;emphasized_a\r\n                                    text           = '\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0443\u0437\u0435\u043b' ).\r\n            ENDIF.\r\n\r\n            lv_carrid_key = lo_node-&gt;get_key( ).\r\n            IF lv_count &gt; 1.\r\n              lo_item = lo_node-&gt;get_item( 'CARRID' ).\r\n              lo_item-&gt;set_type(  if_salv_c_item_type=&gt;button ).\r\n              lo_item-&gt;set_value( '\u0412\u0441\u0435' ).\r\n            ENDIF.\r\n\r\n            lo_item = lo_node-&gt;get_item( 'CITYFROM' ).\r\n            lo_item-&gt;set_font( if_salv_c_item_font=&gt;fixed_size ).\r\n            lo_item-&gt;set_enabled( abap_false ).\r\n          CATCH cx_salv_msg.\r\n        ENDTRY.\r\n      ELSE.\r\n        TRY.\r\n            lo_node = lo_nodes-&gt;add_node(\r\n                                  related_node   = lv_carrid_key\r\n                                  relationship   = cl_gui_column_tree=&gt;relat_last_child\r\n                                  data_row       = &lt;fs_line&gt;\r\n                                  row_style      = IF_SALV_C_TREE_STYLE=&gt;emphasized_negative\r\n                                  text           = '\u0414\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u0443\u0437\u0435\u043b - \u0414\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u0443\u0437\u0435\u043b' ).\r\n            lo_item = lo_node-&gt;get_item( 'CARRID' ).\r\n            lo_item-&gt;set_type(  if_salv_c_item_type=&gt;checkbox ).\r\n            lo_item-&gt;set_editable( abap_true ).\r\n          CATCH cx_salv_msg.\r\n        ENDTRY.\r\n      ENDIF.\r\n      lv_carrid = &lt;fs_line&gt;-carrid.\r\n    ENDLOOP.\r\n  ENDMETHOD.                    \"create_nodes\r\n\r\n  METHOD get_data.\r\n    SELECT * FROM spfli INTO CORRESPONDING FIELDS OF TABLE gt_full_tab.\r\n  ENDMETHOD.                    \"get_data\r\n\r\n  METHOD create_tree.\r\n    TRY.\r\n        cl_salv_tree=&gt;factory(\r\n          IMPORTING\r\n            r_salv_tree = go_alv_tree\r\n          CHANGING\r\n            t_table     = gt_empty_tab ).\r\n      CATCH cx_salv_error.\r\n        MESSAGE '\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 ALV' TYPE 'E'.\r\n    ENDTRY.\r\n  ENDMETHOD.                    \"create_tree\r\n\r\n  METHOD setup_functions.\r\n    go_alv_tree-&gt;set_screen_status(\r\n      pfstatus      =  'SALV_STANDARD'\r\n      REPORT        =  sy-repid \" \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043b\u0438 \u043a \u0441\u0435\u0431\u0435 \u0432 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0443 \u0441\u0442\u0430\u0442\u0443\u0441\r\n      set_functions =  go_alv_tree-&gt;c_functions_all ).\r\n  ENDMETHOD.\r\n\r\n  METHOD setup_columns.\r\n    DATA:\r\n      lo_columns TYPE REF TO cl_salv_columns_tree,\r\n      lo_column  TYPE REF TO cl_salv_column_tree.\r\n\r\n    TRY.\r\n      lo_columns = go_alv_tree-&gt;get_columns( ).\r\n      lo_columns-&gt;set_optimize( abap_true ).\r\n      lo_column ?= lo_columns-&gt;get_column( 'MANDT' ).\r\n      lo_column-&gt;set_technical( abap_true ).\r\n      lo_column ?= lo_columns-&gt;get_column( 'FLTYPE' ).\r\n      lo_column-&gt;set_technical( abap_true ).\r\n      lo_column ?= lo_columns-&gt;get_column( 'PERIOD' ).\r\n      lo_column-&gt;set_technical( abap_true ).\r\n    CATCH cx_salv_msg cx_salv_not_found.\r\n    ENDTRY.\r\n  ENDMETHOD.\r\n\r\n  METHOD on_link_click.\r\n    DATA: lo_nodes      TYPE REF TO cl_Salv_nodes,\r\n          lo_main_node  TYPE REF TO cl_salv_node,\r\n          lo_item       TYPE REF TO cl_salv_item,\r\n          lo_child_node TYPE REF TO cl_salv_node.\r\n\r\n    lo_nodes = go_alv_tree-&gt;get_nodes( ).\r\n\r\n    TRY.\r\n      lo_main_node  = lo_nodes-&gt;get_node( node_key ).\r\n      lo_child_node = lo_main_node-&gt;get_first_child( ).\r\n      WHILE lo_child_node IS BOUND.\r\n        lo_item = lo_child_node-&gt;get_item( 'CARRID' ).\r\n\r\n        IF lo_item-&gt;is_checked( ) = abap_true.\r\n          lo_item-&gt;set_checked( abap_false ).\r\n        ELSE.\r\n          lo_item-&gt;set_checked( abap_true ).\r\n        ENDIF.\r\n\r\n        lo_child_node = lo_child_node-&gt;get_next_sibling( ).\r\n      ENDWHILE.\r\n    CATCH cx_salv_msg.\r\n      EXIT.\r\n    ENDTRY.\r\n\r\n  ENDMETHOD.\r\n\r\n  METHOD setup_events.\r\n    DATA: lo_events TYPE REF TO cl_salv_events_tree.\r\n\r\n    lo_events = go_alv_tree-&gt;get_event( ).\r\n    SET HANDLER on_link_click FOR lo_events.\r\n  ENDMETHOD.\r\n\r\nENDCLASS.                    \"lcl_report IMPLEMENTATION<\/pre>\n","protected":false},"excerpt":{"rendered":"<p>\u0414\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0434\u0435\u0440\u0435\u0432\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u0449\u0435\u0433\u043e \u0438\u0437 \u043b\u044e\u0431\u043e\u0433\u043e \u0447\u0438\u0441\u043b\u0430 \u0443\u0440\u043e\u0432\u043d\u0435\u0439 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0432 SALV \u043c\u043e\u0434\u0435\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u043b\u0430\u0441\u0441 &#8212; cl_salv_tree. \u0421\u0442\u0440\u043e\u043a\u0438 \u0432 \u0442\u0430\u043a\u043e\u043c \u0434\u0435\u0440\u0435\u0432\u0435 \u043d\u0430\u0437\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0443\u0437\u043b\u0430\u043c\u0438. \u041a\u0430\u0436\u0434\u044b\u0439 \u0443\u0437\u0435\u043b, \u043d\u0435 \u0432\u0430\u0436\u043d\u043e, \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u043e\u043d \u0443\u0440\u043e\u0432\u043d\u0435, \u0438\u043c\u0435\u0435\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u043c\u0438. \u0414\u0435\u0440\u0435\u0432\u043e, \u043a\u0430\u043a \u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u043a\u043b\u0430\u0441\u0441\u044b SALV \u043c\u043e\u0434\u0435\u043b\u0438, \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0444\u0430\u0431\u0440\u0438\u0447\u043d\u043e-\u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0430 factory(). \u041f\u0440\u0438 \u044d\u0442\u043e\u043c \u043f\u0440\u0438 \u0435\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0435 [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[308],"tags":[199,200],"_links":{"self":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/789"}],"collection":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/comments?post=789"}],"version-history":[{"count":16,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/789\/revisions"}],"predecessor-version":[{"id":6478,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/789\/revisions\/6478"}],"wp:attachment":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/media?parent=789"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/categories?post=789"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/tags?post=789"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}