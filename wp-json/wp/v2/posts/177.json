{"id":177,"date":"2012-01-09T14:57:05","date_gmt":"2012-01-09T10:57:05","guid":{"rendered":"http:\/\/abap-blog.ru\/?p=177"},"modified":"2021-03-02T09:53:04","modified_gmt":"2021-03-02T05:53:04","slug":"put-k-tranzakcii-v-menyu","status":"publish","type":"post","link":"https:\/\/abap-blog.ru\/osnovy-abap\/put-k-tranzakcii-v-menyu\/","title":{"rendered":"\u041f\u0443\u0442\u044c \u043a \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043f\u043e \u043c\u0435\u043d\u044e"},"content":{"rendered":"<p>\u041f\u043e\u0434 \u043a\u0430\u0442\u043e\u043c \u043e\u0442\u0447\u0451\u0442 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0449\u0438\u0439 \u0432\u0441\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043f\u0443\u0442\u0438 \u043f\u043e \u043a\u043e\u0434\u0443 <strong>\u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0439<\/strong> \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438<!--more--><\/p>\n<pre class=\"lang:abap decode:true\">REPORT ZNEWPATH.\r\n\r\nTYPES: BEGIN OF ty_menu,\r\n        parent TYPE MENU_NUM_5,\r\n        children TYPE MENU_NUM_5,\r\n        LEVEL TYPE MENU_NUM_2,\r\n       END OF ty_menu.\r\n\r\nDATA: lt_mencu TYPE STANDARD TABLE OF SMENCUSNEW,\r\n      ls_mencu TYPE SMENCUSNEW,\r\n      lt_menu  TYPE STANDARD TABLE OF ty_menu,\r\n      ls_menu  TYPE ty_menu,\r\n      lv_parent TYPE MENU_NUM_5.\r\n\r\nFIELD-SYMBOLS:\r\n      &lt;fs_mencu&gt; TYPE SMENCUSNEW,\r\n      &lt;fs_menu&gt;  TYPE ty_menu.\r\n\r\nPARAMETERS: TRANS LIKE TSTC-TCODE OBLIGATORY.\r\n\r\nSTART-OF-SELECTION.\r\n  SELECT * FROM SMENCUSNEW INTO CORRESPONDING FIELDS OF TABLE lt_mencu WHERE REPORT = TRANS AND CUSTOMIZED = 'S'.\r\n  IF sy-subrc NE 0.\r\n    MESSAGE '\u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442' TYPE 'S'.\r\n    EXIT.\r\n  ENDIF.\r\n\r\n  LOOP AT lt_mencu ASSIGNING &lt;fs_mencu&gt;.\r\n    CLEAR ls_menu.\r\n    ls_menu-parent = &lt;fs_mencu&gt;-object_id.\r\n    ls_menu-LEVEL  = &lt;fs_mencu&gt;-menu_level.\r\n    APPEND ls_menu TO lt_menu.\r\n\r\n    lv_parent = &lt;fs_mencu&gt;-parent_id.\r\n    CLEAR sy-subrc.\r\n    WHILE sy-subrc EQ 0.\r\n      SELECT SINGLE * FROM SMENCUSNEW INTO ls_mencu WHERE OBJECT_ID EQ lv_parent AND CUSTOMIZED = 'S'.\r\n      IF sy-subrc EQ 0.\r\n        ls_menu-children = ls_mencu-object_id.\r\n        ls_menu-LEVEL = ls_mencu-menu_level.\r\n        APPEND ls_menu TO lt_menu.\r\n        lv_parent = ls_mencu-parent_id.\r\n        CLEAR ls_mencu.\r\n      ENDIF.\r\n    ENDWHILE.\r\n  ENDLOOP.\r\n\r\n  SORT lt_menu BY parent children LEVEL.\r\n\r\n  LOOP AT lt_menu ASSIGNING &lt;fs_menu&gt; WHERE children IS INITIAL.\r\n    WRITE: \/(30) '\u0413\u043b\u0430\u0432\u043d\u043e\u0435 \u043c\u0435\u043d\u044e' COLOR 2.\r\n    LOOP AT lt_menu INTO ls_menu WHERE parent EQ &lt;fs_menu&gt;-parent AND children IS NOT INITIAL.\r\n      PERFORM GET_MENUTEXT USING ls_menu-children ls_menu-LEVEL.\r\n    ENDLOOP.\r\n    PERFORM GET_MENUTEXT USING &lt;fs_menu&gt;-parent &lt;fs_menu&gt;-LEVEL.\r\n    ULINE.\r\n  ENDLOOP.\r\n\r\n* \u0417\u0430\u043f\u0443\u0441\u043a \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438\r\nAT LINE-SELECTION.\r\n  IF NOT TRANS IS INITIAL.\r\n    CALL TRANSACTION TRANS.\r\n  ENDIF.\r\n\r\nFORM GET_MENUTEXT USING objectid TYPE MENU_NUM_5\r\n                        LEVEL    TYPE MENU_NUM_2.\r\n  DATA: lv_title TYPE SSM_TITLE,\r\n        lvl TYPE MENU_NUM_2.\r\n  lvl = LEVEL + 1.\r\n  SELECT SINGLE TEXT FROM SMENCUST INTO lv_title WHERE OBJECT_ID EQ objectid AND SPRAS EQ sy-langu.\r\n  WRITE: \/lvl(140) lv_title COLOR 2.\r\nENDFORM.<\/pre>\n","protected":false},"excerpt":{"rendered":"<p>\u041f\u043e\u0434 \u043a\u0430\u0442\u043e\u043c \u043e\u0442\u0447\u0451\u0442 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0449\u0438\u0439 \u0432\u0441\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043f\u0443\u0442\u0438 \u043f\u043e \u043a\u043e\u0434\u0443 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0439 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[306,305],"tags":[34],"_links":{"self":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/177"}],"collection":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/comments?post=177"}],"version-history":[{"count":10,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/177\/revisions"}],"predecessor-version":[{"id":2113,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/177\/revisions\/2113"}],"wp:attachment":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/media?parent=177"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/categories?post=177"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/tags?post=177"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}