{"id":109,"date":"2012-01-06T09:37:25","date_gmt":"2012-01-06T05:37:25","guid":{"rendered":"http:\/\/abap-blog.ru\/?p=109"},"modified":"2021-03-02T09:51:27","modified_gmt":"2021-03-02T05:51:27","slug":"vibor-fajlov-na-ekrane","status":"publish","type":"post","link":"https:\/\/abap-blog.ru\/osnovy-abap\/files\/vibor-fajlov-na-ekrane\/","title":{"rendered":"\u0412\u044b\u0431\u043e\u0440 \u0444\u0430\u0439\u043b\u043e\u0432 \u043d\u0430 \u044d\u043a\u0440\u0430\u043d\u0435 \u0432\u044b\u0431\u043e\u0440\u0430"},"content":{"rendered":"<p>\u041f\u0440\u0438 \u0440\u0430\u0431\u043e\u0442\u0435 \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0432 ABAP \u0432\u0441\u0442\u0430\u0435\u0442 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u044c \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0432\u044b\u0431\u043e\u0440\u0430 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u044d\u043a\u0440\u0430\u043d\u0435 \u0432\u044b\u0431\u043e\u0440\u0430, \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043c\u0435\u0442\u043e\u0434\u043e\u043c \u043a\u043b\u0430\u0441\u0441\u0430\u00a0<strong>cl_gui_frontend_services=&gt;file_open_dialog<\/strong> \u0438\u043b\u0438 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043e\u0431\u0451\u0440\u0442\u043a\u043e\u0439 \u043d\u0430\u0434 \u043d\u0438\u043c\u00a0<strong>cl_salv_test_data=&gt;select_file.<\/strong>\u00a0\u0414\u0430\u043b\u0435\u0435 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u043a\u0430\u043a \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0432\u044b\u0431\u043e\u0440 \u0444\u0430\u0439\u043b\u0430 \u043a\u0430\u043a \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0442\u0430\u043a \u0438 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439.<\/p>\n<p><!--more--><\/p>\n<pre class=\"lang:abap decode:true\">DATA: l_true TYPE btch0000-char1.\r\nDATA: v_file TYPE STRING,\r\n      l_path TYPE dxlpath,\r\n      l_abend_flag TYPE dxxabend,\r\n      file TYPE filename,\r\n      flag1 TYPE C.\r\n\r\nDATA: it_fieldvalues TYPE STANDARD TABLE OF dynpread,\r\n      wa_fieldvalues TYPE dynpread.\r\n\r\n*----------------------------------------------------------------------*\r\n* SELECTION- SCREEN\r\n*----------------------------------------------------------------------*\r\n\r\nSELECTION-SCREEN BEGIN OF BLOCK b1 WITH FRAME TITLE text-001.\r\nPARAMETERS: p_file(120) LOWER CASE OBLIGATORY.\r\nPARAMETERS: p_appl RADIOBUTTON GROUP g1,\r\n            p_pres RADIOBUTTON GROUP g1.\r\nSELECTION-SCREEN END OF BLOCK b1.\r\n\r\n*----------------------------------------------------------------------*\r\n* AT SELECTION- SCREEN ( F4 functionality )\r\n*----------------------------------------------------------------------*\r\n\r\nAT SELECTION-SCREEN ON VALUE-REQUEST FOR p_file.\r\n  PERFORM f4_file_name.\r\n\r\n*----------------------------------------------------------------------*\r\n* START-OF-SELECTION.\r\n*----------------------------------------------------------------------*\r\n\r\nSTART-OF-SELECTION.\r\n  IF p_appl = 'X'.\r\n    PERFORM validate_server_file.\r\n  ELSE.\r\n    PERFORM validate_presentation_server.\r\n  ENDIF.\r\n\r\n*----------------------------------------------------------------------*\r\n* END-OF-SELECTION\r\n*----------------------------------------------------------------------*\r\n\r\nEND-OF-SELECTION.\r\n  IF flag1 = 'X'.\r\n    MESSAGE s777(hk) WITH '\u0424\u0430\u0439\u043b \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442'.\r\n    CLEAR flag1.\r\n  ELSE.\r\n    WRITE '\u0424\u0430\u0439\u043b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0432\u044b\u0431\u0440\u0430\u043d'.\r\n  ENDIF.\r\n\r\n*&amp;---------------------------------------------------------------------*\r\n*&amp; \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439\r\n*&amp;---------------------------------------------------------------------*\r\nFORM validate_server_file.\r\n  DATA: l_file TYPE tpfht-pffile.\r\n  CLEAR l_file.\r\n  l_file = p_file.\r\n\r\n  CALL FUNCTION 'PFL_CHECK_OS_FILE_EXISTENCE'\r\n    EXPORTING\r\n      fully_qualified_filename = l_file\r\n    IMPORTING\r\n      file_exists              = l_true.\r\n\r\n  IF l_true = SPACE.\r\n    flag1 = 'X'.\r\n    STOP.\r\n  ENDIF.\r\n\r\nENDFORM.                    \" validate_server_file\r\n\r\n*&amp;---------------------------------------------------------------------*\r\n*&amp; \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f (\u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0435)\r\n*&amp;---------------------------------------------------------------------*\r\nFORM validate_presentation_server .\r\n  DATA: RESULT,\r\n        xfile TYPE STRING.\r\n  xfile = p_file.\r\n\r\n  CALL METHOD cl_gui_frontend_services=&gt;file_exist\r\n    EXPORTING\r\n      file   = xfile\r\n    RECEIVING\r\n      RESULT = RESULT.\r\n  IF RESULT NE 'X'.\r\n    flag1 = 'X'.\r\n    STOP.\r\n  ENDIF.\r\n\r\nENDFORM.                    \"validate_presentation_server\r\n\r\n*&amp;---------------------------------------------------------------------*\r\n*&amp; \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 F4 \u0434\u043b\u044f \u043f\u043e\u043b\u044f \u0441 \u0438\u043c\u0435\u043d\u0435\u043c \u0444\u0430\u0439\u043b\u0430\r\n*&amp;---------------------------------------------------------------------*\r\nFORM f4_file_name .\r\n\r\n  wa_fieldvalues-fieldname = 'P_PRES'.\r\n  APPEND wa_fieldvalues TO it_fieldvalues.\r\n  CLEAR wa_fieldvalues.\r\n\r\n  wa_fieldvalues-fieldname = 'P_APPL'.\r\n  APPEND wa_fieldvalues TO it_fieldvalues.\r\n  CLEAR wa_fieldvalues.\r\n\r\n  \" \u0421\u0447\u0438\u0442\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u044d\u043a\u0440\u0430\u043d\u0430 \u0432\u044b\u0431\u043e\u0440\u0430\r\n  CALL FUNCTION 'DYNP_VALUES_READ'\r\n    EXPORTING\r\n      dyname               = sy-repid\r\n      dynumb               = sy-dynnr\r\n    TABLES\r\n      dynpfields           = it_fieldvalues\r\n    EXCEPTIONS\r\n      invalid_abapworkarea = 1\r\n      invalid_dynprofield  = 2\r\n      invalid_dynproname   = 3\r\n      invalid_dynpronummer = 4\r\n      invalid_request      = 5\r\n      no_fielddescription  = 6\r\n      invalid_parameter    = 7\r\n      undefind_error       = 8\r\n      double_conversion    = 9\r\n      stepl_not_found      = 10\r\n      OTHERS               = 11.\r\n\r\n  READ TABLE it_fieldvalues INTO wa_fieldvalues WITH KEY fieldname = 'P_APPL'.\r\n\r\n  \" \u0412 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0442\u043e\u0433\u043e \u0447\u0442\u043e \u0432\u044b\u0431\u0440\u0430\u043d\u043e \u043d\u0430 \u044d\u043a\u0440\u0430\u043d\u0435 \u0432\u044b\u0431\u043e\u0440\u0430, \u0431\u0443\u0434\u0435\u043c \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0442\u044c\r\n  \" \u043b\u0438\u0431\u043e \u0444\u0430\u0439\u043b \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430, \u043b\u0438\u0431\u043e \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435.\r\n  IF wa_fieldvalues-fieldvalue = 'X'.\r\n    PERFORM get_f4_application.\r\n  ELSE.\r\n    PERFORM get_f4_presentation.\r\n  ENDIF.\r\n\r\nENDFORM.                    \" f4_file_name\r\n\r\n*&amp;---------------------------------------------------------------------*\r\n*&amp; \u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433 \u0432\u044b\u0431\u043e\u0440\u0430 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435\r\n*&amp;---------------------------------------------------------------------*\r\nFORM get_f4_presentation .\r\n\r\n*-- F4 functionality for file name on Presentation Server\r\n  DATA: l_file TYPE STRING.\r\n  CALL METHOD cl_salv_test_data=&gt;select_file\r\n    IMPORTING\r\n      filename = l_file.\r\n\r\n  p_file = l_file.\r\n\r\nENDFORM.                    \" get_f4_presentation\r\n\r\n*&amp;---------------------------------------------------------------------*\r\n*&amp; \u0414\u0438\u0430\u043b\u043e\u0433 \u0432\u044b\u0431\u043e\u0440\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435\r\n*&amp;---------------------------------------------------------------------*\r\nFORM get_f4_application .\r\n\r\n*-- F4 functionality for filename on Application Server\r\n  CALL FUNCTION 'F4_DXFILENAME_TOPRECURSION'\r\n    EXPORTING\r\n      i_location_flag       = 'A'\r\n      i_server              = ' '\r\n      i_path                = '\/secure_data\/data_mig\/dev'\r\n    IMPORTING\r\n      o_path                = l_path\r\n      abend_flag            = l_abend_flag\r\n    EXCEPTIONS\r\n      communication_failure = 1\r\n      system_failure        = 2\r\n      rfc_error             = 3.\r\n  IF sy-subrc EQ 0.\r\n    p_file = l_path.\r\n  ENDIF.\r\n  IF l_abend_flag = 'X'.\r\n    EXIT.  ENDIF.\r\n\r\nENDFORM.                    \" get_f4_application<\/pre>\n<p>\u0415\u0449\u0435 \u043e\u0434\u0438\u043d \u0441\u043f\u043e\u0441\u043e\u0431 \u0432\u044b\u0431\u043e\u0440\u0430 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439:<\/p>\n<pre class=\"lang:abap decode:true\">SELECTION-SCREEN BEGIN OF BLOCK 002 WITH FRAME TITLE text-002.\r\nPARAMETERS : p_aps LIKE rlgrap-filename MODIF ID pth .\r\nSELECTION-SCREEN END OF BLOCK 002.\r\nDATA : path_name(150) TYPE C.\r\n\r\nAT SELECTION-SCREEN ON VALUE-REQUEST FOR p_aps.\r\n\r\nSUBMIT rs_get_f4_dir_from_applserv AND RETURN.\r\nIMPORT path_name FROM MEMORY ID 'PATH_NAME_SDL'.\r\n p_aps = path_name.<\/pre>\n","protected":false},"excerpt":{"rendered":"<p>\u041f\u0440\u0438 \u0440\u0430\u0431\u043e\u0442\u0435 \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0432 ABAP \u0432\u0441\u0442\u0430\u0435\u0442 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u044c \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0432\u044b\u0431\u043e\u0440\u0430 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u044d\u043a\u0440\u0430\u043d\u0435 \u0432\u044b\u0431\u043e\u0440\u0430, \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043c\u0435\u0442\u043e\u0434\u043e\u043c \u043a\u043b\u0430\u0441\u0441\u0430\u00a0cl_gui_frontend_services=&gt;file_open_dialog \u0438\u043b\u0438 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u043e\u0431\u0451\u0440\u0442\u043a\u043e\u0439 \u043d\u0430\u0434 \u043d\u0438\u043c\u00a0cl_salv_test_data=&gt;select_file.\u00a0\u0414\u0430\u043b\u0435\u0435 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u043a\u0430\u043a \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0432\u044b\u0431\u043e\u0440 \u0444\u0430\u0439\u043b\u0430 \u043a\u0430\u043a \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0442\u0430\u043a \u0438 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439.<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[311],"tags":[7,23,25,8,24],"_links":{"self":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/109"}],"collection":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/comments?post=109"}],"version-history":[{"count":12,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/109\/revisions"}],"predecessor-version":[{"id":2098,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/posts\/109\/revisions\/2098"}],"wp:attachment":[{"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/media?parent=109"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/categories?post=109"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/abap-blog.ru\/wp-json\/wp\/v2\/tags?post=109"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}